{% extends "base.html"%}

{% block content %}

<html lang="en">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<head>
    <meta charset="UTF-8">
    <title>Chatbot</title>
</head>
<body>

<div class="card-wrapper">

    <div class="card">

        <h1 class="center">Dashboard</h1>
        <p class="center">í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤.</p>

        <div class="center">
            <a href="/user/signout" class="btn btn--secondary">ë¡œê·¸ì•„ì›ƒ</a>
        </div>

    </div>

<div class="card">

        <h1 class="center">User Information</h1>

        <p>
            <strong>Email:</strong> {{ session['user']['email']}}<br>
            <strong>Age:</strong> {{ session['user']['age']}}<br>
            <strong>Gender:</strong> {{ session['user']['gender']}}
        </p>

    </div>
</div>

<div class="card-wrapper">

   <div class="card">

        <h1 class="center">{{ session['user']['nickname']}}ë‹˜, <br><br> ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë– ì…¨ì–´ìš”? ğŸ˜Š </h1>
        <form id="textForm">
        <input type="text" autocomplete="off" id="user_say" name="user_say" class="field">
        <div id="response_text"></div>

</form>

    </div>
</div>

<div class="card-wrapper">
    <div class="chatbox">
        <div class="chatbox__support">
            <div class="chatbox__header">
                <div class="chatbox__image--header">
                    <img src="https://img.icons8.com/color/96/bmo.png" alt="image">
                </div>
                <div class="chatbox__content--header">
                    <h4 class="chatbox__heading--header">Chatbot Active!</h4>
                    <p class="chatbox__description--header">ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” Zectì—ìš”! <br>ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</p>
                </div>
            </div>
            <div class="chatbox__messages">
                <div></div>
            </div>
            <div class="chatbox__footer">
                <input type="text" placeholder="Write a message...">
                <button class="chatbox__send--footer send__button">Send</button>
            </div>
        </div>
        <div class="chatbox__button">
            <button><img src="{{ url_for('static', filename='images/chatbox-icon.svg') }}" /></button>
        </div>
    </div>
</div>

    <script>
        $SCRIPT_ROOT = {{ request.script_root|tojson }};
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='app.js') }}"></script>

    <script>
        myform  =  document.querySelector("#textForm");
        myform.addEventListener("submit", textFormSubmit);

        function textFormSubmit(event){
            event.preventDefault()
            message_txt = $("#user_say").val()
            $.post("http://168.131.155.77:5001//predict-emotion", {"user_say": message_txt }, function(data){
                 responseHtml = "<p> {{ session['user']['nickname']}}ë‹˜, ì§€ê¸ˆ ê¸°ë¶„ì´ <strong>"+data+"</strong> ì´ì‹ ê°€ ë´ìš”. <br>ì±—ë´‡ê³¼ ëŒ€í™” ì–´ë– ì„¸ìš”? </p>"
                $('#response_text').html(responseHtml)
            });
    }
    </script>

</body>
</html>


{%endblock%}